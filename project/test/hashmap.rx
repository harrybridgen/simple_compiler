#
 ========================================= 
 HashMap Correctness Test         
 ========================================= 
#
import std.hashmap;

#
 --- create map --- 
#
m := hashmap(5);

#
 --- insert keys --- 
#
put(m, 1, 10);
put(m, 6, 60);   # collides with 1 (same bucket mod 5) #
put(m, 11, 110); # collides again #

println "After inserts:";
println get(m, 1);    # 10 #
println get(m, 6);    # 60 #
println get(m, 11);   # 110 #

#
 --- remove middle key (creates tombstone) --- 
#
println "Remove key 6:";
remove(m, 6);

#
 --- ensure probing continues past tombstone --- 
#
println "Lookup after removal:";
println has(m, 1);    # 1 #
println has(m, 6);    # 0 #
println has(m, 11);   # 1 #

println get(m, 1);    # 10 #
println get(m, 6);    # 0 #
println get(m, 11);   # 110 #

#
 --- insert into tombstone slot --- 
#
println "Reinsert key 16:";
put(m, 16, 160);      # should reuse tombstone #

println get(m, 16);   # 160 #
println has(m, 11);   # still 1 #

# --- final state sanity --- #
println "Final size:";
println m.size;       # should be 3#
